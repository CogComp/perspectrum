{% load static %}
{% load claim_filter %}

<!DOCTYPE html>
<html lang="en">
<script src="https://code.jquery.com/jquery-3.3.1.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js"
        integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh"
        crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js"
        integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ"
        crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css"
      integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flat-ui/2.3.0/css/flat-ui.min.css"
      integrity="sha256-7bYJaNviFZlH+bKqZlshmYKeyvkp+fXBQuerWp2AXlA=" crossorigin="anonymous"/>
<link rel="stylesheet" href="{% static "css/style.css" %}">
<script type="text/javascript" src="{% static "js/vis.js" %}"></script>
<link href="{% static "css/vis-network.min.css" %}" rel="stylesheet" type="text/css"/>


<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Perspective Annotation Interface</title>
<script src="{% static "js/persp.js" %}"></script>

<style type="text/css">
    #mynetwork {
        width: 100%;
        height: 100%;
        border: 1px solid lightgray;
    }

    code {
        font-size: 14px;
        background: #dddddd;
    }

    .indented {
        margin-left: 00px;
    }

    .sep {
        height: 1px;
        width: 30%;
        margin-left: 40px;
        background-color: #dddddd;
    }
</style>

</head>
<body>
{#<div class="container-fluid">#}
{#    <h4 class="persp-claim-title pallete pallete-peter-river">#}
{#        {{ claim }}#}
{#    </h4>#}
{#    <div class="row">#}
{#        <div class="col persps-container tile">#}
{#            <h6>#}
{#                Perspectives For#}
{#            </h6>#}
{#            {% for cluster in persp_sup %}#}
{#                <a class="persp-title btn btn-block btn-lg btn-default palette-turquoise">#}
{#                    {% for p in cluster %}#}
{#                        {{ p }} <br>#}
{#                    {% endfor %}#}
{#                </a>#}
{#            {% endfor %}#}
{#        </div>#}
{#        <div class="col persps-container tile">#}
{#            <h6>#}
{#                Perspectives Against#}
{#            </h6>#}
{#            {% for cluster in persp_und %}#}
{#                <a class="persp-title btn btn-block btn-lg btn-default palette-carrot">#}
{#                    {% for p in cluster %}#}
{#                        {{ p }} <br>#}
{#                    {% endfor %}#}
{#                </a>#}
{#            {% endfor %}#}
{#        </div>#}
{#    </div>#}
{#</div>#}

<div class="container-fluid">
    <div class="row">
        <div class="tile" style="margin: 100px;">
            <div id="mynetwork" style="float: left; width: 1800px;" ></div>
        </div>
    </div>
</div>

<script type="text/javascript">
    var claim_text = "{{ claim }}";

    var nodes = [
        {
            id: 0,
            label: "<b>Claim:</b> \n" + claim_text,
            widthConstraint: {maximum: 200},
            group: 0,
            font: {multi: 'html'}
        }
    ];

    // perspective nodes
    {% for p, pid, cluster_id, evidences  in persp_sup %}
        nodes.push(
            {
                id: {{ pid }},
                widthConstraint: {maximum: 200},
                label: "<b>Perspective:</b> \n {{ p }}",
                group: {{ cluster_id }},
                font: {multi: 'html'}
            });
    {% endfor %}

    {% for p, pid, cluster_id, evidences  in persp_und %}
        nodes.push(
            {
                id: {{ pid }},
                widthConstraint: {maximum: 200},
                label: "<b>Perspective:</b> \n {{ p }}",
                group: {{ cluster_id }},
                font: {multi: 'html'}
            });
    {% endfor %}

    // evidence nodes
    {% for eId, evidences in used_evidences_and_texts %}
        nodes.push(
            {
                id: (10000 + {{ eId }}),
                widthConstraint: {maximum: 300},
                label: "<b>Evidence:</b> {{ evidences }}",
                group: -1,
                font: {multi: 'html', size: 7}
            });
    {% endfor %}


    var edges = [];

    // adding claim to perspective edges
    {% for p, pid, cluster_id, evidences  in persp_und %}
        edges.push({from: 0, to: {{ pid }}, label: "<b>Stance:</b> Oppose", font: {multi: 'html'}});
    {% endfor %}

    {% for p, pid, cluster_id, evidences in persp_sup %}
        edges.push({from: 0, to: {{ pid }}, label: "<b>Stance:</b> Support", font: {multi: 'html'}});
    {% endfor %}

    // adding edges between perspectives
    {% for p1, pid1, cluster_id1, evidences1 in persp_und %}
        {% for p2, pid2, cluster_id2, evidences2 in persp_und %}
            {% if pid2 > pid1 and cluster_id2 == cluster_id1 %}
                edges.push({from: {{ pid1 }}, to: {{ pid2 }}, label: "", font: {multi: 'html'}});
            {% endif %}
        {% endfor %}
    {% endfor %}

    // adding perspective to evidence edges
    {% for p, pid, cluster_id, evidences in persp_sup %}
        {% for eId in evidences %}
            edges.push({from: {{ pid }}, to: (10000 + {{ eId }}), label: "", font: {multi: 'html'}});
        {% endfor %}
    {% endfor %}

    var container = document.getElementById('mynetwork');
    var data = {
        nodes: nodes,
        edges: edges
    };
    var options = {
        edges: {
            font: {
                size: 12
            },
            widthConstraint: {
                maximum: 90
            }
        },
        nodes: {
            shape: 'box',
            margin: 10,
            widthConstraint: {
                maximum: 200
            }
        },
        physics: {
            enabled: true,
            repulsion: {
                centralGravity: 0.0000001,
                //damping: 3
                //springConstant: 2
                //springLength: 200000
                damping: 0.000001
                //nodeDistance: 200000000
            },
            solver: "forceAtlas2Based"
        }
    };
    var network = new vis.Network(container, data, options);
</script>


</body>
</html>